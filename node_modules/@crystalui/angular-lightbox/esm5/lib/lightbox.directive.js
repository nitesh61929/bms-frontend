import { __decorate } from "tslib";
import { Directive, ElementRef, Input, Output, HostListener, HostBinding, OnInit, EventEmitter } from '@angular/core';
import { EventService } from './event.service';
import { CrystalLightbox } from './lightbox.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './lightbox.service';
import * as ɵngcc2 from './event.service';
var LightboxDirective = /** @class */ (function () {
    function LightboxDirective(lightbox, eventService, elementRef) {
        var _this = this;
        this.lightbox = lightbox;
        this.eventService = eventService;
        this.elementRef = elementRef;
        this.properties = {};
        this.events = new EventEmitter();
        this.hostLightboxGroup = true;
        this.globalEventsSubscription = this.eventService.emitter.subscribe(function (event) {
            _this.handleGlobalEvents(event);
        });
    }
    Object.defineProperty(LightboxDirective.prototype, "hostSimpleMode", {
        get: function () {
            return this.simpleMode;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LightboxDirective.prototype, "isGroupImage", {
        get: function () {
            return this.elementRef.nativeElement.closest(".lightbox-group");
        },
        enumerable: true,
        configurable: true
    });
    LightboxDirective.prototype.onClick = function (event) {
        if (this.disable) {
            return;
        }
        if (this.isGroupImage) {
            this.eventService.emitChangeEvent({
                type: 'thumbnail:click',
                elementRef: this.elementRef,
                properties: this.properties
            });
        }
        else {
            this.image = this.getImage();
            this.lightbox.open({
                images: [this.image],
                properties: this.properties,
                index: 0
            });
        }
    };
    LightboxDirective.prototype.ngOnChanges = function (changes) {
        this.properties = Object.assign({}, this.properties, this.getProperties(changes));
    };
    LightboxDirective.prototype.handleGlobalEvents = function (event) {
        this.events.emit(event);
    };
    LightboxDirective.prototype.getImage = function () {
        var image = {};
        var nativeElement = this.elementRef.nativeElement;
        if (this.fullImage) {
            image.fullImage = this.fullImage;
        }
        image.thumbnailImage = {
            path: nativeElement.src,
            height: nativeElement.naturalHeight,
            width: nativeElement.naturalWidth
        };
        image.nativeElement = nativeElement;
        return image;
    };
    ;
    LightboxDirective.prototype.getProperties = function (changes) {
        var properties = {};
        for (var prop in changes) {
            if (prop !== 'fullImage') {
                properties[prop] = changes[prop].currentValue;
            }
        }
        return properties;
    };
    LightboxDirective.ctorParameters = function () { return [
        { type: CrystalLightbox },
        { type: EventService },
        { type: ElementRef }
    ]; };
    __decorate([
        Input()
    ], LightboxDirective.prototype, "fullImage", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "properties", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "loop", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "backgroundOpacity", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "counter", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "imageMaxHeight", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "imageMaxWidth", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "animationDuration", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "animationMode", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "animationTimingFunction", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "closeButtonText", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "counterSeparator", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "disable", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "simpleMode", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "backgroundColor", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "hideThumbnail", void 0);
    __decorate([
        Input()
    ], LightboxDirective.prototype, "gestureEnable", void 0);
    __decorate([
        Output()
    ], LightboxDirective.prototype, "events", void 0);
    __decorate([
        HostBinding('class.lightbox-single')
    ], LightboxDirective.prototype, "hostLightboxGroup", void 0);
    __decorate([
        HostBinding('class.lightbox-simple-mode')
    ], LightboxDirective.prototype, "hostSimpleMode", null);
    __decorate([
        HostListener('click', ['$event'])
    ], LightboxDirective.prototype, "onClick", null);
LightboxDirective.ɵfac = function LightboxDirective_Factory(t) { return new (t || LightboxDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.CrystalLightbox), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.EventService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
LightboxDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LightboxDirective, selectors: [["", "lightbox", ""]], hostVars: 4, hostBindings: function LightboxDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function LightboxDirective_click_HostBindingHandler($event) { return ctx.onClick($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵclassProp("lightbox-single", ctx.hostLightboxGroup)("lightbox-simple-mode", ctx.hostSimpleMode);
    } }, inputs: { properties: "properties", fullImage: "fullImage", loop: "loop", backgroundOpacity: "backgroundOpacity", counter: "counter", imageMaxHeight: "imageMaxHeight", imageMaxWidth: "imageMaxWidth", animationDuration: "animationDuration", animationMode: "animationMode", animationTimingFunction: "animationTimingFunction", closeButtonText: "closeButtonText", counterSeparator: "counterSeparator", disable: "disable", simpleMode: "simpleMode", backgroundColor: "backgroundColor", hideThumbnail: "hideThumbnail", gestureEnable: "gestureEnable" }, outputs: { events: "events" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(LightboxDirective, [{
        type: Directive,
        args: [{
                selector: '[lightbox]'
            }]
    }], function () { return [{ type: ɵngcc1.CrystalLightbox }, { type: ɵngcc2.EventService }, { type: ɵngcc0.ElementRef }]; }, { properties: [{
            type: Input
        }], events: [{
            type: Output
        }], hostLightboxGroup: [{
            type: HostBinding,
            args: ['class.lightbox-single']
        }], hostSimpleMode: [{
            type: HostBinding,
            args: ['class.lightbox-simple-mode']
        }], onClick: [{
            type: HostListener,
            args: ['click', ['$event']]
        }], fullImage: [{
            type: Input
        }], loop: [{
            type: Input
        }], backgroundOpacity: [{
            type: Input
        }], counter: [{
            type: Input
        }], imageMaxHeight: [{
            type: Input
        }], imageMaxWidth: [{
            type: Input
        }], animationDuration: [{
            type: Input
        }], animationMode: [{
            type: Input
        }], animationTimingFunction: [{
            type: Input
        }], closeButtonText: [{
            type: Input
        }], counterSeparator: [{
            type: Input
        }], disable: [{
            type: Input
        }], simpleMode: [{
            type: Input
        }], backgroundColor: [{
            type: Input
        }], hideThumbnail: [{
            type: Input
        }], gestureEnable: [{
            type: Input
        }] }); })();
    return LightboxDirective;
}());
export { LightboxDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHRib3guZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyJAY3J5c3RhbHVpL2FuZ3VsYXItbGlnaHRib3gvbGliL2xpZ2h0Ym94LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEgsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBSyxvQkFBb0IsQ0FBQzs7OztBQU9wRDtBQUVvQixJQWdDaEIsMkJBQ1ksUUFBeUIsRUFDekIsWUFBMEIsRUFDMUIsVUFBc0I7QUFDckMsUUFKRyxpQkFTQztBQUVMLFFBVmdCLGFBQVEsR0FBUixRQUFRLENBQWlCO0FBQUUsUUFDM0IsaUJBQVksR0FBWixZQUFZLENBQWM7QUFDMUMsUUFBZ0IsZUFBVSxHQUFWLFVBQVUsQ0FBWTtBQUFFLFFBaEMzQixlQUFVLEdBQWUsRUFBRSxDQUFDO0FBQ3hDLFFBZ0JhLFdBQU0sR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztBQUVsRSxRQUEwQyxzQkFBaUIsR0FBWSxJQUFJLENBQUM7QUFDM0UsUUFhTyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUMvRCxVQUFDLEtBQUs7QUFBSyxZQUNQLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM5QyxRQUFXLENBQUMsQ0FDSixDQUFDO0FBQ1QsSUFBRyxDQUFDO0FBRUwsSUFuQkksc0JBQUksNkNBQWM7QUFDckIsYUFERztBQUFlLFlBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0FBQzlCLFFBQUcsQ0FBQztBQUVKO0FBQTJCO0FBQ0wsT0FIbEI7QUFFTCxJQUFJ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QSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBY0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFwRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBakNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFrQkEsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFxQkEsQUFsRUEsQUFBQSxBQUpBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUF3R0EsQUFBQSxBQUFBLEFBQUEsQUF4R0EsQUF3R0EsQUF4R0EsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCwgSG9zdExpc3RlbmVyLCBIb3N0QmluZGluZywgT25Jbml0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEV2ZW50U2VydmljZSB9IGZyb20gJy4vZXZlbnQuc2VydmljZSc7XG5pbXBvcnQgeyBDcnlzdGFsTGlnaHRib3ggfSBmcm9tJy4vbGlnaHRib3guc2VydmljZSc7XG5pbXBvcnQgeyBQcm9wZXJ0aWVzLCBJbWFnZUV4dGVuZGVkLCBJbWFnZSB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAnW2xpZ2h0Ym94XSdcbn0pXG5cbmV4cG9ydCBjbGFzcyBMaWdodGJveERpcmVjdGl2ZSB7XG5cbiAgICBnbG9iYWxFdmVudHNTdWJzY3JpcHRpb247XG4gICAgaW1hZ2U6IEltYWdlRXh0ZW5kZWQ7XG4gICAgQElucHV0KCkgZnVsbEltYWdlOiBJbWFnZTtcbiAgICBASW5wdXQoKSBwcm9wZXJ0aWVzOiBQcm9wZXJ0aWVzID0ge307XG4gICAgQElucHV0KCkgbG9vcDogYm9vbGVhbjtcbiAgICBASW5wdXQoKSBiYWNrZ3JvdW5kT3BhY2l0eTogbnVtYmVyO1xuICAgIEBJbnB1dCgpIGNvdW50ZXI6IGJvb2xlYW47XG4gICAgQElucHV0KCkgaW1hZ2VNYXhIZWlnaHQ6IHN0cmluZztcbiAgICBASW5wdXQoKSBpbWFnZU1heFdpZHRoOiBzdHJpbmc7XG4gICAgQElucHV0KCkgYW5pbWF0aW9uRHVyYXRpb246IG51bWJlcjtcbiAgICBASW5wdXQoKSBhbmltYXRpb25Nb2RlOiAnZGVmYXVsdCcgfCAnem9vbScgfCAnem9vbS1ibHVyJyB8ICd6b29tLXByZWxvYWRlcicgfCAnb3BhY2l0eScgfCAnbm9uZSc7IFxuICAgIEBJbnB1dCgpIGFuaW1hdGlvblRpbWluZ0Z1bmN0aW9uOiBzdHJpbmc7XG4gICAgQElucHV0KCkgY2xvc2VCdXR0b25UZXh0OiBzdHJpbmc7XG4gICAgQElucHV0KCkgY291bnRlclNlcGFyYXRvcjogc3RyaW5nO1xuICAgIEBJbnB1dCgpIGRpc2FibGU6IGJvb2xlYW47XG4gICAgQElucHV0KCkgc2ltcGxlTW9kZTogYm9vbGVhbjtcbiAgICBASW5wdXQoKSBiYWNrZ3JvdW5kQ29sb3I6ICdibGFjaycgfCAnd2hpdGUnO1xuICAgIEBJbnB1dCgpIGhpZGVUaHVtYm5haWw6IGJvb2xlYW47XG4gICAgQElucHV0KCkgZ2VzdHVyZUVuYWJsZTogYm9vbGVhbjtcblxuICAgIEBPdXRwdXQoKSBldmVudHM6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmxpZ2h0Ym94LXNpbmdsZScpIGhvc3RMaWdodGJveEdyb3VwOiBib29sZWFuID0gdHJ1ZTtcbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmxpZ2h0Ym94LXNpbXBsZS1tb2RlJykgXG4gICAgZ2V0IGhvc3RTaW1wbGVNb2RlKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnNpbXBsZU1vZGU7XG4gICAgfVxuXG4gICAgZ2V0IGlzR3JvdXBJbWFnZSgpOmJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xvc2VzdChcIi5saWdodGJveC1ncm91cFwiKTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvciggXG4gICAgICAgIHByaXZhdGUgbGlnaHRib3g6IENyeXN0YWxMaWdodGJveCwgXG4gICAgICAgIHByaXZhdGUgZXZlbnRTZXJ2aWNlOiBFdmVudFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge1xuICAgICAgICB0aGlzLmdsb2JhbEV2ZW50c1N1YnNjcmlwdGlvbiA9IHRoaXMuZXZlbnRTZXJ2aWNlLmVtaXR0ZXIuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVHbG9iYWxFdmVudHMoZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSlcbiAgICBvbkNsaWNrKGV2ZW50KXtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZSl7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pc0dyb3VwSW1hZ2Upe1xuICAgICAgICAgICAgdGhpcy5ldmVudFNlcnZpY2UuZW1pdENoYW5nZUV2ZW50KHtcbiAgICAgICAgICAgICAgICB0eXBlOiAndGh1bWJuYWlsOmNsaWNrJyxcbiAgICAgICAgICAgICAgICBlbGVtZW50UmVmOiB0aGlzLmVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczogdGhpcy5wcm9wZXJ0aWVzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2UgPSB0aGlzLmdldEltYWdlKCk7XG5cbiAgICAgICAgICAgIHRoaXMubGlnaHRib3gub3Blbih7XG4gICAgICAgICAgICAgICAgaW1hZ2VzOiBbdGhpcy5pbWFnZV0sXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczogdGhpcy5wcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICAgIGluZGV4OiAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5wcm9wZXJ0aWVzLCB0aGlzLmdldFByb3BlcnRpZXMoY2hhbmdlcykpO1xuICAgIH1cblxuICAgIGhhbmRsZUdsb2JhbEV2ZW50cyhldmVudCl7XG4gICAgICAgIHRoaXMuZXZlbnRzLmVtaXQoZXZlbnQpO1xuICAgIH1cblxuICAgIGdldEltYWdlKCl7XG4gICAgICAgIGxldCBpbWFnZTogSW1hZ2VFeHRlbmRlZCA9IHt9O1xuICAgICAgICBjb25zdCBuYXRpdmVFbGVtZW50ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKHRoaXMuZnVsbEltYWdlKXtcbiAgICAgICAgICAgIGltYWdlLmZ1bGxJbWFnZSA9IHRoaXMuZnVsbEltYWdlO1xuICAgICAgICB9XG5cbiAgICAgICAgaW1hZ2UudGh1bWJuYWlsSW1hZ2UgPSB7XG4gICAgICAgICAgICBwYXRoOiBuYXRpdmVFbGVtZW50LnNyYyxcbiAgICAgICAgICAgIGhlaWdodDogbmF0aXZlRWxlbWVudC5uYXR1cmFsSGVpZ2h0LFxuICAgICAgICAgICAgd2lkdGg6IG5hdGl2ZUVsZW1lbnQubmF0dXJhbFdpZHRoXG4gICAgICAgIH1cblxuICAgICAgICBpbWFnZS5uYXRpdmVFbGVtZW50ID0gbmF0aXZlRWxlbWVudDtcbiAgICAgICAgcmV0dXJuIGltYWdlO1xuICAgIH07XG5cbiAgICBnZXRQcm9wZXJ0aWVzKGNoYW5nZXMpe1xuICAgICAgICBsZXQgcHJvcGVydGllcyA9IHt9O1xuXG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gY2hhbmdlcykge1xuICAgICAgICAgICAgaWYgKHByb3AgIT09ICdmdWxsSW1hZ2UnKXtcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzW3Byb3BdID0gY2hhbmdlc1twcm9wXS5jdXJyZW50VmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXM7XG4gICAgfVxufVxuIl19