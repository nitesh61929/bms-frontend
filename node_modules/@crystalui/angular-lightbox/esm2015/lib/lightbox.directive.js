import { __decorate } from "tslib";
import { Directive, ElementRef, Input, Output, HostListener, HostBinding, OnInit, EventEmitter } from '@angular/core';
import { EventService } from './event.service';
import { CrystalLightbox } from './lightbox.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './lightbox.service';
import * as ɵngcc2 from './event.service';
let LightboxDirective = class LightboxDirective {
    constructor(lightbox, eventService, elementRef) {
        this.lightbox = lightbox;
        this.eventService = eventService;
        this.elementRef = elementRef;
        this.properties = {};
        this.events = new EventEmitter();
        this.hostLightboxGroup = true;
        this.globalEventsSubscription = this.eventService.emitter.subscribe((event) => {
            this.handleGlobalEvents(event);
        });
    }
    get hostSimpleMode() {
        return this.simpleMode;
    }
    get isGroupImage() {
        return this.elementRef.nativeElement.closest(".lightbox-group");
    }
    onClick(event) {
        if (this.disable) {
            return;
        }
        if (this.isGroupImage) {
            this.eventService.emitChangeEvent({
                type: 'thumbnail:click',
                elementRef: this.elementRef,
                properties: this.properties
            });
        }
        else {
            this.image = this.getImage();
            this.lightbox.open({
                images: [this.image],
                properties: this.properties,
                index: 0
            });
        }
    }
    ngOnChanges(changes) {
        this.properties = Object.assign({}, this.properties, this.getProperties(changes));
    }
    handleGlobalEvents(event) {
        this.events.emit(event);
    }
    getImage() {
        let image = {};
        const nativeElement = this.elementRef.nativeElement;
        if (this.fullImage) {
            image.fullImage = this.fullImage;
        }
        image.thumbnailImage = {
            path: nativeElement.src,
            height: nativeElement.naturalHeight,
            width: nativeElement.naturalWidth
        };
        image.nativeElement = nativeElement;
        return image;
    }
    ;
    getProperties(changes) {
        let properties = {};
        for (var prop in changes) {
            if (prop !== 'fullImage') {
                properties[prop] = changes[prop].currentValue;
            }
        }
        return properties;
    }
};
LightboxDirective.ɵfac = function LightboxDirective_Factory(t) { return new (t || LightboxDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.CrystalLightbox), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.EventService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
LightboxDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LightboxDirective, selectors: [["", "lightbox", ""]], hostVars: 4, hostBindings: function LightboxDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function LightboxDirective_click_HostBindingHandler($event) { return ctx.onClick($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵclassProp("lightbox-single", ctx.hostLightboxGroup)("lightbox-simple-mode", ctx.hostSimpleMode);
    } }, inputs: { properties: "properties", fullImage: "fullImage", loop: "loop", backgroundOpacity: "backgroundOpacity", counter: "counter", imageMaxHeight: "imageMaxHeight", imageMaxWidth: "imageMaxWidth", animationDuration: "animationDuration", animationMode: "animationMode", animationTimingFunction: "animationTimingFunction", closeButtonText: "closeButtonText", counterSeparator: "counterSeparator", disable: "disable", simpleMode: "simpleMode", backgroundColor: "backgroundColor", hideThumbnail: "hideThumbnail", gestureEnable: "gestureEnable" }, outputs: { events: "events" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
LightboxDirective.ctorParameters = () => [
    { type: CrystalLightbox },
    { type: EventService },
    { type: ElementRef }
];
__decorate([
    Input()
], LightboxDirective.prototype, "fullImage", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "properties", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "loop", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "backgroundOpacity", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "counter", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "imageMaxHeight", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "imageMaxWidth", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "animationDuration", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "animationMode", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "animationTimingFunction", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "closeButtonText", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "counterSeparator", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "disable", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "simpleMode", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "backgroundColor", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "hideThumbnail", void 0);
__decorate([
    Input()
], LightboxDirective.prototype, "gestureEnable", void 0);
__decorate([
    Output()
], LightboxDirective.prototype, "events", void 0);
__decorate([
    HostBinding('class.lightbox-single')
], LightboxDirective.prototype, "hostLightboxGroup", void 0);
__decorate([
    HostBinding('class.lightbox-simple-mode')
], LightboxDirective.prototype, "hostSimpleMode", null);
__decorate([
    HostListener('click', ['$event'])
], LightboxDirective.prototype, "onClick", null);
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(LightboxDirective, [{
        type: Directive,
        args: [{
                selector: '[lightbox]'
            }]
    }], function () { return [{ type: ɵngcc1.CrystalLightbox }, { type: ɵngcc2.EventService }, { type: ɵngcc0.ElementRef }]; }, { properties: [{
            type: Input
        }], events: [{
            type: Output
        }], hostLightboxGroup: [{
            type: HostBinding,
            args: ['class.lightbox-single']
        }], hostSimpleMode: [{
            type: HostBinding,
            args: ['class.lightbox-simple-mode']
        }], onClick: [{
            type: HostListener,
            args: ['click', ['$event']]
        }], fullImage: [{
            type: Input
        }], loop: [{
            type: Input
        }], backgroundOpacity: [{
            type: Input
        }], counter: [{
            type: Input
        }], imageMaxHeight: [{
            type: Input
        }], imageMaxWidth: [{
            type: Input
        }], animationDuration: [{
            type: Input
        }], animationMode: [{
            type: Input
        }], animationTimingFunction: [{
            type: Input
        }], closeButtonText: [{
            type: Input
        }], counterSeparator: [{
            type: Input
        }], disable: [{
            type: Input
        }], simpleMode: [{
            type: Input
        }], backgroundColor: [{
            type: Input
        }], hideThumbnail: [{
            type: Input
        }], gestureEnable: [{
            type: Input
        }] }); })();
export { LightboxDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlnaHRib3guZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyJAY3J5c3RhbHVpL2FuZ3VsYXItbGlnaHRib3gvbGliL2xpZ2h0Ym94LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEgsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBSyxvQkFBb0IsQ0FBQzs7OztBQU9wRCxJQUFhLGlCQUFpQixHQUE5QixNQUFhLGlCQUFpQjtBQUU5QixJQWdDSSxZQUNZLFFBQXlCLEVBQ3pCLFlBQTBCLEVBQzFCLFVBQXNCO0FBQ3JDLFFBSGUsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7QUFBRSxRQUMzQixpQkFBWSxHQUFaLFlBQVksQ0FBYztBQUMxQyxRQUFnQixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUUsUUFoQzNCLGVBQVUsR0FBZSxFQUFFLENBQUM7QUFDeEMsUUFnQmEsV0FBTSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO0FBRWxFLFFBQTBDLHNCQUFpQixHQUFZLElBQUksQ0FBQztBQUMzRSxRQWFPLElBQUksQ0FBQyx3QkFBd0IsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQy9ELENBQUMsS0FBSyxFQUFFLEVBQUU7QUFDckIsWUFBZSxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDOUMsUUFBVyxDQUFDLENBQ0osQ0FBQztBQUNULElBQUcsQ0FBQztBQUVMLElBbkJJLElBQUksY0FBYztBQUNwQixRQUFNLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztBQUM5QixJQUFHLENBQUM7QUFFTCxJQUFJLElBQUksWUFBWTtB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Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFDRDs7QUFsSEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWtDQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUZBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWhDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBaUJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBakJBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFjQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQXJFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFqQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQWtCQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQXFCQSxBQWxFQSxBQUFBLEFBSkEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQXdHQSxBQXhHQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbnB1dCwgT3V0cHV0LCBIb3N0TGlzdGVuZXIsIEhvc3RCaW5kaW5nLCBPbkluaXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRXZlbnRTZXJ2aWNlIH0gZnJvbSAnLi9ldmVudC5zZXJ2aWNlJztcbmltcG9ydCB7IENyeXN0YWxMaWdodGJveCB9IGZyb20nLi9saWdodGJveC5zZXJ2aWNlJztcbmltcG9ydCB7IFByb3BlcnRpZXMsIEltYWdlRXh0ZW5kZWQsIEltYWdlIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcblxuQERpcmVjdGl2ZSh7XG4gICAgc2VsZWN0b3I6ICdbbGlnaHRib3hdJ1xufSlcblxuZXhwb3J0IGNsYXNzIExpZ2h0Ym94RGlyZWN0aXZlIHtcblxuICAgIGdsb2JhbEV2ZW50c1N1YnNjcmlwdGlvbjtcbiAgICBpbWFnZTogSW1hZ2VFeHRlbmRlZDtcbiAgICBASW5wdXQoKSBmdWxsSW1hZ2U6IEltYWdlO1xuICAgIEBJbnB1dCgpIHByb3BlcnRpZXM6IFByb3BlcnRpZXMgPSB7fTtcbiAgICBASW5wdXQoKSBsb29wOiBib29sZWFuO1xuICAgIEBJbnB1dCgpIGJhY2tncm91bmRPcGFjaXR5OiBudW1iZXI7XG4gICAgQElucHV0KCkgY291bnRlcjogYm9vbGVhbjtcbiAgICBASW5wdXQoKSBpbWFnZU1heEhlaWdodDogc3RyaW5nO1xuICAgIEBJbnB1dCgpIGltYWdlTWF4V2lkdGg6IHN0cmluZztcbiAgICBASW5wdXQoKSBhbmltYXRpb25EdXJhdGlvbjogbnVtYmVyO1xuICAgIEBJbnB1dCgpIGFuaW1hdGlvbk1vZGU6ICdkZWZhdWx0JyB8ICd6b29tJyB8ICd6b29tLWJsdXInIHwgJ3pvb20tcHJlbG9hZGVyJyB8ICdvcGFjaXR5JyB8ICdub25lJzsgXG4gICAgQElucHV0KCkgYW5pbWF0aW9uVGltaW5nRnVuY3Rpb246IHN0cmluZztcbiAgICBASW5wdXQoKSBjbG9zZUJ1dHRvblRleHQ6IHN0cmluZztcbiAgICBASW5wdXQoKSBjb3VudGVyU2VwYXJhdG9yOiBzdHJpbmc7XG4gICAgQElucHV0KCkgZGlzYWJsZTogYm9vbGVhbjtcbiAgICBASW5wdXQoKSBzaW1wbGVNb2RlOiBib29sZWFuO1xuICAgIEBJbnB1dCgpIGJhY2tncm91bmRDb2xvcjogJ2JsYWNrJyB8ICd3aGl0ZSc7XG4gICAgQElucHV0KCkgaGlkZVRodW1ibmFpbDogYm9vbGVhbjtcbiAgICBASW5wdXQoKSBnZXN0dXJlRW5hYmxlOiBib29sZWFuO1xuXG4gICAgQE91dHB1dCgpIGV2ZW50czogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBIb3N0QmluZGluZygnY2xhc3MubGlnaHRib3gtc2luZ2xlJykgaG9zdExpZ2h0Ym94R3JvdXA6IGJvb2xlYW4gPSB0cnVlO1xuICAgIEBIb3N0QmluZGluZygnY2xhc3MubGlnaHRib3gtc2ltcGxlLW1vZGUnKSBcbiAgICBnZXQgaG9zdFNpbXBsZU1vZGUoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2ltcGxlTW9kZTtcbiAgICB9XG5cbiAgICBnZXQgaXNHcm91cEltYWdlKCk6Ym9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbG9zZXN0KFwiLmxpZ2h0Ym94LWdyb3VwXCIpO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKCBcbiAgICAgICAgcHJpdmF0ZSBsaWdodGJveDogQ3J5c3RhbExpZ2h0Ym94LCBcbiAgICAgICAgcHJpdmF0ZSBldmVudFNlcnZpY2U6IEV2ZW50U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XG4gICAgICAgIHRoaXMuZ2xvYmFsRXZlbnRzU3Vic2NyaXB0aW9uID0gdGhpcy5ldmVudFNlcnZpY2UuZW1pdHRlci5zdWJzY3JpYmUoXG4gICAgICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUdsb2JhbEV2ZW50cyhldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignY2xpY2snLCBbJyRldmVudCddKVxuICAgIG9uQ2xpY2soZXZlbnQpe1xuICAgICAgICBpZiAodGhpcy5kaXNhYmxlKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzR3JvdXBJbWFnZSl7XG4gICAgICAgICAgICB0aGlzLmV2ZW50U2VydmljZS5lbWl0Q2hhbmdlRXZlbnQoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICd0aHVtYm5haWw6Y2xpY2snLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRSZWY6IHRoaXMuZWxlbWVudFJlZixcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB0aGlzLnByb3BlcnRpZXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuZ2V0SW1hZ2UoKTtcblxuICAgICAgICAgICAgdGhpcy5saWdodGJveC5vcGVuKHtcbiAgICAgICAgICAgICAgICBpbWFnZXM6IFt0aGlzLmltYWdlXSxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB0aGlzLnByb3BlcnRpZXMsXG4gICAgICAgICAgICAgICAgaW5kZXg6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnByb3BlcnRpZXMsIHRoaXMuZ2V0UHJvcGVydGllcyhjaGFuZ2VzKSk7XG4gICAgfVxuXG4gICAgaGFuZGxlR2xvYmFsRXZlbnRzKGV2ZW50KXtcbiAgICAgICAgdGhpcy5ldmVudHMuZW1pdChldmVudCk7XG4gICAgfVxuXG4gICAgZ2V0SW1hZ2UoKXtcbiAgICAgICAgbGV0IGltYWdlOiBJbWFnZUV4dGVuZGVkID0ge307XG4gICAgICAgIGNvbnN0IG5hdGl2ZUVsZW1lbnQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcblxuICAgICAgICBpZiAodGhpcy5mdWxsSW1hZ2Upe1xuICAgICAgICAgICAgaW1hZ2UuZnVsbEltYWdlID0gdGhpcy5mdWxsSW1hZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBpbWFnZS50aHVtYm5haWxJbWFnZSA9IHtcbiAgICAgICAgICAgIHBhdGg6IG5hdGl2ZUVsZW1lbnQuc3JjLFxuICAgICAgICAgICAgaGVpZ2h0OiBuYXRpdmVFbGVtZW50Lm5hdHVyYWxIZWlnaHQsXG4gICAgICAgICAgICB3aWR0aDogbmF0aXZlRWxlbWVudC5uYXR1cmFsV2lkdGhcbiAgICAgICAgfVxuXG4gICAgICAgIGltYWdlLm5hdGl2ZUVsZW1lbnQgPSBuYXRpdmVFbGVtZW50O1xuICAgICAgICByZXR1cm4gaW1hZ2U7XG4gICAgfTtcblxuICAgIGdldFByb3BlcnRpZXMoY2hhbmdlcyl7XG4gICAgICAgIGxldCBwcm9wZXJ0aWVzID0ge307XG5cbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBjaGFuZ2VzKSB7XG4gICAgICAgICAgICBpZiAocHJvcCAhPT0gJ2Z1bGxJbWFnZScpe1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXNbcHJvcF0gPSBjaGFuZ2VzW3Byb3BdLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHJvcGVydGllcztcbiAgICB9XG59XG4iXX0=