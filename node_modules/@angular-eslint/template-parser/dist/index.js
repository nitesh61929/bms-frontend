var e=require("@angular/compiler"),t=require("eslint-scope");function n(e){return{start:{line:e.start.line+1,column:e.start.col},end:{line:e.end.line+1,column:e.end.col}}}function r(t,r){if("Element"!==r.type)throw new Error("convertElementSourceSpanToLoc is intented to be used only with elements.");return e.getHtmlTagDefinition(r.name).isVoid&&(r=function(t,n){const{rootNodes:r}=(o||(o=new e.HtmlParser)).parse(t.getSourceCode().getText(),t.getFilename());return function t(n,r){for(const o of n){if(o.sourceSpan.start.line===r.start.line&&o.sourceSpan.start.offset===r.start.offset)return o;if(o instanceof e.Element){const e=t(o.children,r);if(null!==e)return e}}return null}(r,n.sourceSpan)}(t,r)||r),n(r.sourceSpan)}let o=null;const s={ASTWithSource:["ast"],Binary:["left","right"],BoundAttribute:["value"],BoundEvent:["handler"],BoundText:["value"],Element:["children","inputs","outputs","attributes"],Interpolation:["expressions"],PrefixNot:["expression"],Program:["templateNodes"],PropertyRead:["receiver"],Template:["templateAttrs","children","inputs"]};function l(e){let t=null;return"comments"!==e&&"leadingComments"!==e&&"loc"!==e&&"parent"!==e&&"range"!==e&&"tokens"!==e&&"trailingComments"!==e&&null!==(t=this[e])&&"object"==typeof t&&("string"==typeof t.type||Array.isArray(t))}function a(e){return null!==e&&"object"==typeof e&&"string"==typeof e.type}function i(o,i){const c={type:"Program",comments:[],tokens:[],range:[0,0],loc:{start:{line:0,column:0},end:{line:0,column:0}},templateNodes:e.parseTemplate(o,i.filePath,{preserveWhitespaces:!1}).nodes,value:o},u=new t.ScopeManager({});new t.Scope(u,"module",null,c,!1),function e(t){let n=0,r=0;const o=s[t.type]||function(e){return Object.keys(e).filter(l,e)}(t);for(n=0;n<o.length;++n){const s=t[o[n]],l=Array.isArray(s);if(void 0!==s.type&&(s.__originalType=s.type),l||s.type||(s.type=s.constructor.name),l)for(r=0;r<s.length;++r){const t=s[r];void 0!==t.type&&(t.__originalType=t.type),t.type&&"number"!=typeof t.type||(t.type=t.constructor.name),a(t)&&e(t)}else a(s)&&e(s)}}(c);const p=function(e){let t=null;return e.templateNodes.forEach(e=>{const n=e.startSourceSpan||e.sourceSpan;t?n&&n.start.offset<t.start.offset&&(t=n):t=n}),t}(c),f=function(e){let t=null;return e.templateNodes.forEach(e=>{const n=e.endSourceSpan||e.sourceSpan;t?n&&n.end.offset>t.end.offset&&(t=n):t=n}),t}(c);return p&&f&&(c.range=[p.start.offset,f.end.offset],c.loc={start:n(p).start,end:n(f).end}),{ast:c,scopeManager:u,visitorKeys:s,services:{convertNodeSourceSpanToLoc:n,convertElementSourceSpanToLoc:r}}}module.exports={parseForESLint:i,parse:function(e,t){return i(e,t).ast}};
