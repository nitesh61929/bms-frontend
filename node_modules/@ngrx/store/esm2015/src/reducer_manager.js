/**
 * @fileoverview added by tsickle
 * Generated from: src/reducer_manager.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { ActionsSubject } from './actions_subject';
import { INITIAL_REDUCERS, INITIAL_STATE, REDUCER_FACTORY } from './tokens';
import { createFeatureReducerFactory, createReducerFactory, omit, } from './utils';
/**
 * @abstract
 */
import * as ɵngcc0 from '@angular/core';
export class ReducerObservable extends Observable {
}
/**
 * @abstract
 */
export class ReducerManagerDispatcher extends ActionsSubject {
}
/** @type {?} */
export const UPDATE = (/** @type {?} */ ('@ngrx/store/update-reducers'));
export class ReducerManager extends BehaviorSubject {
    /**
     * @param {?} dispatcher
     * @param {?} initialState
     * @param {?} reducers
     * @param {?} reducerFactory
     */
    constructor(dispatcher, initialState, reducers, reducerFactory) {
        super(reducerFactory(reducers, initialState));
        this.dispatcher = dispatcher;
        this.initialState = initialState;
        this.reducers = reducers;
        this.reducerFactory = reducerFactory;
    }
    /**
     * @param {?} feature
     * @return {?}
     */
    addFeature(feature) {
        this.addFeatures([feature]);
    }
    /**
     * @param {?} features
     * @return {?}
     */
    addFeatures(features) {
        /** @type {?} */
        const reducers = features.reduce((/**
         * @param {?} reducerDict
         * @param {?} __1
         * @return {?}
         */
        (reducerDict, { reducers, reducerFactory, metaReducers, initialState, key }) => {
            /** @type {?} */
            const reducer = typeof reducers === 'function'
                ? createFeatureReducerFactory(metaReducers)(reducers, initialState)
                : createReducerFactory(reducerFactory, metaReducers)(reducers, initialState);
            reducerDict[key] = reducer;
            return reducerDict;
        }), (/** @type {?} */ ({})));
        this.addReducers(reducers);
    }
    /**
     * @param {?} feature
     * @return {?}
     */
    removeFeature(feature) {
        this.removeFeatures([feature]);
    }
    /**
     * @param {?} features
     * @return {?}
     */
    removeFeatures(features) {
        this.removeReducers(features.map((/**
         * @param {?} p
         * @return {?}
         */
        (p) => p.key)));
    }
    /**
     * @param {?} key
     * @param {?} reducer
     * @return {?}
     */
    addReducer(key, reducer) {
        this.addReducers({ [key]: reducer });
    }
    /**
     * @param {?} reducers
     * @return {?}
     */
    addReducers(reducers) {
        this.reducers = Object.assign(Object.assign({}, this.reducers), reducers);
        this.updateReducers(Object.keys(reducers));
    }
    /**
     * @param {?} featureKey
     * @return {?}
     */
    removeReducer(featureKey) {
        this.removeReducers([featureKey]);
    }
    /**
     * @param {?} featureKeys
     * @return {?}
     */
    removeReducers(featureKeys) {
        featureKeys.forEach((/**
         * @param {?} key
         * @return {?}
         */
        (key) => {
            this.reducers = (/** @type {?} */ (omit(this.reducers, key) /*TODO(#823)*/));
        }));
        this.updateReducers(featureKeys);
    }
    /**
     * @private
     * @param {?} featureKeys
     * @return {?}
     */
    updateReducers(featureKeys) {
        this.next(this.reducerFactory(this.reducers, this.initialState));
        this.dispatcher.next((/** @type {?} */ ({
            type: UPDATE,
            features: featureKeys,
        })));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.complete();
    }
}
ReducerManager.ɵfac = function ReducerManager_Factory(t) { return new (t || ReducerManager)(ɵngcc0.ɵɵinject(ReducerManagerDispatcher), ɵngcc0.ɵɵinject(INITIAL_STATE), ɵngcc0.ɵɵinject(INITIAL_REDUCERS), ɵngcc0.ɵɵinject(REDUCER_FACTORY)); };
ReducerManager.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: ReducerManager, factory: ReducerManager.ɵfac });
/** @nocollapse */
ReducerManager.ctorParameters = () => [
    { type: ReducerManagerDispatcher },
    { type: undefined, decorators: [{ type: Inject, args: [INITIAL_STATE,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [INITIAL_REDUCERS,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [REDUCER_FACTORY,] }] }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ReducerManager, [{
        type: Injectable
    }], function () { return [{ type: ReducerManagerDispatcher }, { type: undefined, decorators: [{
                type: Inject,
                args: [INITIAL_STATE]
            }] }, { type: undefined, decorators: [{
                type: Inject,
                args: [INITIAL_REDUCERS]
            }] }, { type: undefined, decorators: [{
                type: Inject,
                args: [REDUCER_FACTORY]
            }] }]; }, null); })();
if (false) {
    /**
     * @type {?}
     * @private
     */
    ReducerManager.prototype.dispatcher;
    /**
     * @type {?}
     * @private
     */
    ReducerManager.prototype.initialState;
    /**
     * @type {?}
     * @private
     */
    ReducerManager.prototype.reducers;
    /**
     * @type {?}
     * @private
     */
    ReducerManager.prototype.reducerFactory;
}
/** @type {?} */
export const REDUCER_MANAGER_PROVIDERS = [
    ReducerManager,
    { provide: ReducerObservable, useExisting: ReducerManager },
    { provide: ReducerManagerDispatcher, useExisting: ActionsSubject },
];

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVkdWNlcl9tYW5hZ2VyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9tb2R1bGVzL3N0b3JlL3NyYy9yZWR1Y2VyX21hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBdUIsTUFBTSxlQUFlLENBQUM7QUFDeEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbkQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBUW5ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQzVFLE9BQU8sRUFDTCwyQkFBMkIsRUFDM0Isb0JBQW9CLEVBQ3BCLElBQUksR0FDTCxNQUFNLFNBQVMsQ0FBQztBQUNqQjtBQUNHO0FBQWE7O0FBQWhCLE1BQU0sT0FBZ0IsaUJBQWtCLFNBQVEsVUFFL0M7QUFBRyxDQUFBO0FBQ0o7QUFBSTtBQUFhO0FBQWpCLE1BQU0sT0FBZ0Isd0JBQXlCLFNBQVEsY0FBYztBQUFHLENBQUE7QUFDeEU7QUFBQSxNQUFNLE9BQU8sTUFBTSxHQUFHLG1CQUFBLDZCQUE2QixFQUFpQztBQUdwRixNQUFNLE9BQU8sY0FBZSxTQUFRLGVBQXdDO0FBQzFFO0FBQVE7QUFDSTtBQUNnQjtBQUN2QjtBQUFpQztBQUFRLElBRjlDLFlBQ1UsVUFBb0MsRUFDYixZQUFpQixFQUNkLFFBQW9DLEVBRTlELGNBQThDO0FBQ3ZELFFBQ0MsS0FBSyxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQztBQUNsRCxRQVBZLGVBQVUsR0FBVixVQUFVLENBQTBCO0FBQUMsUUFDZCxpQkFBWSxHQUFaLFlBQVksQ0FBSztBQUFDLFFBQ2YsYUFBUSxHQUFSLFFBQVEsQ0FBNEI7QUFBQyxRQUUvRCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0M7QUFDMUQsSUFF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Q29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9uRGVzdHJveSwgUHJvdmlkZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBBY3Rpb25zU3ViamVjdCB9IGZyb20gJy4vYWN0aW9uc19zdWJqZWN0JztcbmltcG9ydCB7XG4gIEFjdGlvbixcbiAgQWN0aW9uUmVkdWNlcixcbiAgQWN0aW9uUmVkdWNlckZhY3RvcnksXG4gIEFjdGlvblJlZHVjZXJNYXAsXG4gIFN0b3JlRmVhdHVyZSxcbn0gZnJvbSAnLi9tb2RlbHMnO1xuaW1wb3J0IHsgSU5JVElBTF9SRURVQ0VSUywgSU5JVElBTF9TVEFURSwgUkVEVUNFUl9GQUNUT1JZIH0gZnJvbSAnLi90b2tlbnMnO1xuaW1wb3J0IHtcbiAgY3JlYXRlRmVhdHVyZVJlZHVjZXJGYWN0b3J5LFxuICBjcmVhdGVSZWR1Y2VyRmFjdG9yeSxcbiAgb21pdCxcbn0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBSZWR1Y2VyT2JzZXJ2YWJsZSBleHRlbmRzIE9ic2VydmFibGU8XG4gIEFjdGlvblJlZHVjZXI8YW55LCBhbnk+XG4+IHt9XG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUmVkdWNlck1hbmFnZXJEaXNwYXRjaGVyIGV4dGVuZHMgQWN0aW9uc1N1YmplY3Qge31cbmV4cG9ydCBjb25zdCBVUERBVEUgPSAnQG5ncngvc3RvcmUvdXBkYXRlLXJlZHVjZXJzJyBhcyAnQG5ncngvc3RvcmUvdXBkYXRlLXJlZHVjZXJzJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJlZHVjZXJNYW5hZ2VyIGV4dGVuZHMgQmVoYXZpb3JTdWJqZWN0PEFjdGlvblJlZHVjZXI8YW55LCBhbnk+PlxuICBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZGlzcGF0Y2hlcjogUmVkdWNlck1hbmFnZXJEaXNwYXRjaGVyLFxuICAgIEBJbmplY3QoSU5JVElBTF9TVEFURSkgcHJpdmF0ZSBpbml0aWFsU3RhdGU6IGFueSxcbiAgICBASW5qZWN0KElOSVRJQUxfUkVEVUNFUlMpIHByaXZhdGUgcmVkdWNlcnM6IEFjdGlvblJlZHVjZXJNYXA8YW55LCBhbnk+LFxuICAgIEBJbmplY3QoUkVEVUNFUl9GQUNUT1JZKVxuICAgIHByaXZhdGUgcmVkdWNlckZhY3Rvcnk6IEFjdGlvblJlZHVjZXJGYWN0b3J5PGFueSwgYW55PlxuICApIHtcbiAgICBzdXBlcihyZWR1Y2VyRmFjdG9yeShyZWR1Y2VycywgaW5pdGlhbFN0YXRlKSk7XG4gIH1cblxuICBhZGRGZWF0dXJlKGZlYXR1cmU6IFN0b3JlRmVhdHVyZTxhbnksIGFueT4pIHtcbiAgICB0aGlzLmFkZEZlYXR1cmVzKFtmZWF0dXJlXSk7XG4gIH1cblxuICBhZGRGZWF0dXJlcyhmZWF0dXJlczogU3RvcmVGZWF0dXJlPGFueSwgYW55PltdKSB7XG4gICAgY29uc3QgcmVkdWNlcnMgPSBmZWF0dXJlcy5yZWR1Y2UoXG4gICAgICAoXG4gICAgICAgIHJlZHVjZXJEaWN0LFxuICAgICAgICB7IHJlZHVjZXJzLCByZWR1Y2VyRmFjdG9yeSwgbWV0YVJlZHVjZXJzLCBpbml0aWFsU3RhdGUsIGtleSB9XG4gICAgICApID0+IHtcbiAgICAgICAgY29uc3QgcmVkdWNlciA9XG4gICAgICAgICAgdHlwZW9mIHJlZHVjZXJzID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICA/IGNyZWF0ZUZlYXR1cmVSZWR1Y2VyRmFjdG9yeShtZXRhUmVkdWNlcnMpKHJlZHVjZXJzLCBpbml0aWFsU3RhdGUpXG4gICAgICAgICAgICA6IGNyZWF0ZVJlZHVjZXJGYWN0b3J5KHJlZHVjZXJGYWN0b3J5LCBtZXRhUmVkdWNlcnMpKFxuICAgICAgICAgICAgICAgIHJlZHVjZXJzLFxuICAgICAgICAgICAgICAgIGluaXRpYWxTdGF0ZVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgIHJlZHVjZXJEaWN0W2tleV0gPSByZWR1Y2VyO1xuICAgICAgICByZXR1cm4gcmVkdWNlckRpY3Q7XG4gICAgICB9LFxuICAgICAge30gYXMgeyBba2V5OiBzdHJpbmddOiBBY3Rpb25SZWR1Y2VyPGFueSwgYW55PiB9XG4gICAgKTtcblxuICAgIHRoaXMuYWRkUmVkdWNlcnMocmVkdWNlcnMpO1xuICB9XG5cbiAgcmVtb3ZlRmVhdHVyZShmZWF0dXJlOiBTdG9yZUZlYXR1cmU8YW55LCBhbnk+KSB7XG4gICAgdGhpcy5yZW1vdmVGZWF0dXJlcyhbZmVhdHVyZV0pO1xuICB9XG5cbiAgcmVtb3ZlRmVhdHVyZXMoZmVhdHVyZXM6IFN0b3JlRmVhdHVyZTxhbnksIGFueT5bXSkge1xuICAgIHRoaXMucmVtb3ZlUmVkdWNlcnMoZmVhdHVyZXMubWFwKChwKSA9PiBwLmtleSkpO1xuICB9XG5cbiAgYWRkUmVkdWNlcihrZXk6IHN0cmluZywgcmVkdWNlcjogQWN0aW9uUmVkdWNlcjxhbnksIGFueT4pIHtcbiAgICB0aGlzLmFkZFJlZHVjZXJzKHsgW2tleV06IHJlZHVjZXIgfSk7XG4gIH1cblxuICBhZGRSZWR1Y2VycyhyZWR1Y2VyczogeyBba2V5OiBzdHJpbmddOiBBY3Rpb25SZWR1Y2VyPGFueSwgYW55PiB9KSB7XG4gICAgdGhpcy5yZWR1Y2VycyA9IHsgLi4udGhpcy5yZWR1Y2VycywgLi4ucmVkdWNlcnMgfTtcbiAgICB0aGlzLnVwZGF0ZVJlZHVjZXJzKE9iamVjdC5rZXlzKHJlZHVjZXJzKSk7XG4gIH1cblxuICByZW1vdmVSZWR1Y2VyKGZlYXR1cmVLZXk6IHN0cmluZykge1xuICAgIHRoaXMucmVtb3ZlUmVkdWNlcnMoW2ZlYXR1cmVLZXldKTtcbiAgfVxuXG4gIHJlbW92ZVJlZHVjZXJzKGZlYXR1cmVLZXlzOiBzdHJpbmdbXSkge1xuICAgIGZlYXR1cmVLZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgdGhpcy5yZWR1Y2VycyA9IG9taXQodGhpcy5yZWR1Y2Vycywga2V5KSAvKlRPRE8oIzgyMykqLyBhcyBhbnk7XG4gICAgfSk7XG4gICAgdGhpcy51cGRhdGVSZWR1Y2VycyhmZWF0dXJlS2V5cyk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVJlZHVjZXJzKGZlYXR1cmVLZXlzOiBzdHJpbmdbXSkge1xuICAgIHRoaXMubmV4dCh0aGlzLnJlZHVjZXJGYWN0b3J5KHRoaXMucmVkdWNlcnMsIHRoaXMuaW5pdGlhbFN0YXRlKSk7XG4gICAgdGhpcy5kaXNwYXRjaGVyLm5leHQoPEFjdGlvbj57XG4gICAgICB0eXBlOiBVUERBVEUsXG4gICAgICBmZWF0dXJlczogZmVhdHVyZUtleXMsXG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmNvbXBsZXRlKCk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IFJFRFVDRVJfTUFOQUdFUl9QUk9WSURFUlM6IFByb3ZpZGVyW10gPSBbXG4gIFJlZHVjZXJNYW5hZ2VyLFxuICB7IHByb3ZpZGU6IFJlZHVjZXJPYnNlcnZhYmxlLCB1c2VFeGlzdGluZzogUmVkdWNlck1hbmFnZXIgfSxcbiAgeyBwcm92aWRlOiBSZWR1Y2VyTWFuYWdlckRpc3BhdGNoZXIsIHVzZUV4aXN0aW5nOiBBY3Rpb25zU3ViamVjdCB9LFxuXTtcbiJdfQ==